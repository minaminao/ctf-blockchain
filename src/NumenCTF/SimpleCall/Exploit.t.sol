// SPDX-License-Identifier: UNLICENSED
pragma solidity ^0.7.0;
pragma abicoder v2;

import "forge-std/Test.sol";
import "./challenge/call.sol";
import "./Exploit.sol";

contract ExploitTest is Test {
    function test() public {
        address playerAddress = makeAddr("player");
        ExistingStock stock = new ExistingStock();
        vm.deal(playerAddress, 1 ether);
        address instanceAddress = address(stock);

        vm.startPrank(playerAddress, playerAddress);
        Exploit exploit = new Exploit();
        exploit.exploit(instanceAddress);
        vm.stopPrank();

        emit log_uint(stock.balanceOf(address(exploit)));
        emit log_uint(stock.allowance(address(stock), address(exploit)));

        assertTrue(stock.isSolved(), "Invalid Instance");
    }
}
